// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id              String          @id @default(cuid())
  createdAt       DateTime        @default(now())
  wallets         Wallet[]
  isApproved      Boolean         @default(false)
  airdropProfile  AirdropProfile? 
  hodlScore       Int             @default(0)
  hodlLastUpdated DateTime?
  unlockedAvatars String[]        @default(["alien"])
  requests        AvatarRequest[]
  equippedAvatar  String          @default("alien")
  username        String?         @unique
}

model AirdropProfile {
  id              String    @id @default(cuid())
  userId          String    @unique
  user            User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // Airdrop Tracking Fields
  totalAllocation Float     @default(0)
  lastCheckIn     DateTime?
  weeklyClaimed   Float     @default(0)
  multiplier      Float     @default(1.0)
  
  updatedAt       DateTime  @updatedAt
}

model Wallet {
  address    String     @id // The Solana Public Key
  isPrimary  Boolean    @default(false)
  userId     String
  user       User       @relation(fields: [userId], references: [id])
  verifiedAt DateTime   @default(now())
  lockedK9s  LockedK9[] 
}

model LockedK9 {
  id                  String    @id @default(cuid())
  userWallet          String
  nftMint             String    @unique
  nftName             String
  nftImage            String
  lockDate            DateTime  @default(now())
  originalNTWRKAmount Float
  interestRate        Float
  currentUnlockCost   Float
  unlocked            Boolean   @default(false)
  unlockDate          DateTime?
  unlockSignature     String?
  lastInterestUpdate  DateTime  @default(now())
  wallet              Wallet    @relation(fields: [userWallet], references: [address])
}

model SystemSettings {
  key         String   @id @unique // e.g., "k9_impound_payout"
  value       String   // e.g., "100000"
  description String?  // e.g., "Payout amount for K9s"
  updatedBy   String?  // The wallet address of the admin who changed it
  updatedAt   DateTime @updatedAt
}

model Announcement {
  id        String   @id @default(cuid())
  title     String
  content   String
  date      DateTime @default(now())
  isActive  Boolean  @default(true)
}

model UserGallery {
  id          String   @id @default(cuid())
  owner       String   @unique // The Wallet Address (e.g., "6cAE...")
  name        String   @default("My Noble Gallery")
  description String?
  isPublic    Boolean  @default(true)
  
  // We store assets as a JSON array for performance.
  // Structure: [{ mint: "...", position: 0, image: "...", name: "..." }]
  assets      Json     
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model AvatarRequest {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id])
  wallet    String   
  nftId     String
  nftName   String
  nftImage  String
  status    String   @default("PENDING") // "PENDING", "GRANTED"
  createdAt DateTime @default(now())
}